{% extends "leave_app/base.html" %}
{% block title %}Manager - Pending Leaves{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold tracking-tight mb-2">Pending Leave Requests</h1>
<p class="mb-4 text-sm text-slate-500 dark:text-slate-400">
  Displays only leave requests from your subordinates that are currently in Pending status
</p>

<!-- ðŸ”¹ Pending Leave Table -->
<table class="w-full text-sm rounded-2xl border border-slate-100 bg-white/80 shadow-sm overflow-hidden dark:border-slate-800 dark:bg-slate-900/70 ">
  <thead class="bg-slate-50 text-slate-700 dark:bg-slate-800/70 dark:text-slate-100">
    <tr>
      <th class="text-left py-2 px-3">Employee</th>
      <th class="text-left px-3">Leave Type</th>
      <th class="text-left px-3">Duration</th>
      <th class="text-left px-3">Attachment</th>
      <th class="text-left px-3">Reason</th>
      <th class="text-left px-3">Action</th>
    </tr>
  </thead>
  <tbody>
    {% for leave in pending_leaves %}
    <tr class="border-t border-slate-100 dark:border-slate-800">
      <td class="py-2 px-3">
        {{ leave.employee.user.get_full_name|default:leave.employee.user.username }}
      </td>
      <td class="px-3">{{ leave.leave_type.name }}</td>
      <td class="px-3">
        {{ leave.start_date }} - {{ leave.end_date }}
        {% if leave.half_day %}
          <span class="ml-1 text-xs text-indigo-600 dark:text-indigo-400">(Half Day)</span>
        {% endif %}
      </td>
      <td class="px-3">
          {% if leave.attachment %}
              <a href="{{ leave.attachment.url }}" target="_blank"
              class="text-xs text-indigo-600 hover:text-indigo-500 dark:text-indigo-300">
                  View File
              </a>
          {% else %}
              <span class="text-xs text-slate-400 dark:text-slate-500">-</span>
          {% endif %}
      </td>
      <td class="px-3 truncate max-w-xs">
        {{ leave.reason|truncatechars:50 }}
      </td>
      <td class="px-3">
        <a href="{% url 'leave_app:manager_leave_detail' leave.pk %}"
          class="text-xs font-medium text-blue-600 hover:text-blue-500">
          View Details
        </a>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5" class="py-3 text-center text-slate-500 dark:text-slate-400">
        No pending leave requests
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- ðŸ”¹ Leave Request History -->
<h2 class="mt-8 mb-2 text-xl font-semibold tracking-tight">
  Leave Request History
</h2>
<p class="mb-4 text-sm text-slate-500 dark:text-slate-400">
  Displays leave requests from your subordinates that have been approved / rejected / cancelled
</p>

<table class="w-full text-sm rounded-2xl border border-slate-100 bg-white/80 shadow-sm overflow-hidden dark:border-slate-800 dark:bg-slate-900/70 ">
  <thead class="bg-slate-50 text-slate-700 dark:bg-slate-800/70 dark:text-slate-100">
    <tr>
      <th class="text-left py-2 px-3">Employee</th>
      <th class="text-left px-3">Leave Type</th>
      <th class="text-left px-3">Duration</th>
      <th class="text-left px-3">Status</th>
      <th class="text-left px-3">Reviewed By</th>
      <th class="text-left px-3">Last Updated</th>
      <th class="text-left px-3">Manager Comment</th>
    </tr>
  </thead>
  <tbody>
    {% for leave in history_leaves %}
    <tr class="border-t border-slate-100 dark:border-slate-800">
      <td class="py-2 px-3">
        {{ leave.employee.user.get_full_name|default:leave.employee.user.username }}
      </td>
      <td class="px-3">{{ leave.leave_type.name }}</td>
      <td class="px-3">
        {{ leave.start_date }} - {{ leave.end_date }}
        {% if leave.half_day %}
          <span class="ml-1 text-xs text-indigo-600 dark:text-indigo-400">(Half Day)</span>
        {% endif %}
      </td>
      <td class="px-3">
        <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium
          {% if leave.status == 'APPROVED' %}
              bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200
          {% elif leave.status == 'REJECTED' %}
              bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-200
          {% elif leave.status == 'PENDING' %}
              bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200
          {% elif leave.status == 'CANCELLED' %}
              bg-slate-100 text-slate-800 dark:bg-slate-800/70 dark:text-slate-200
          {% endif %}
        ">
          {{ leave.get_status_display }}
        </span>
      </td>
      <td class="px-3">
        {% if leave.approver %}
          {{ leave.approver.get_full_name|default:leave.approver.username }}
        {% else %}
          -
        {% endif %}
      </td>
      <td class="px-3">
        {{ leave.updated_at|date:"Y-m-d H:i" }}
      </td>
      <td class="px-3 truncate max-w-xs">
        {{ leave.approve_comment|default:"-"|truncatechars:50 }}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="7" class="py-3 text-center text-slate-500 dark:text-slate-400">
        No leave request history
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

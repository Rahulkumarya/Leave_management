{% load static %}
{% load nav_extras %}

<!doctype html>
<html lang="en" class="h-full">

<head>
    <meta charset="utf-8">
    <title>{% block title %}Leave System{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'image/favicon.ico' %}">
    <link href="{% static 'css/tailwind.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/loader.css' %}">
    <link rel="stylesheet" href="{% static 'css/theme-toggle.css' %}">
</head>

<body class="min-h-screen bg-slate-50 text-slate-900 transition-colors duration-300
             dark:bg-slate-950 dark:text-slate-50">

    <nav class="bg-white/80 backdrop-blur border-b border-slate-200
           dark:bg-slate-900/80 dark:border-slate-800">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <a href="{% url 'leave_app:dashboard' %}"
                class="font-semibold text-lg tracking-tight text-slate-900 dark:text-slate-50">
                Leave<span class="text-indigo-600 dark:text-indigo-400">System</span>
            </a>

            <div class="flex items-center gap-4 text-sm">
                {% if user.is_authenticated %}
                <a href="{% url 'leave_app:leave_request_list' %}"
                    class="hover:text-indigo-600 dark:hover:text-indigo-300">
                    My Leaves
                </a>

                {% if user|has_group:"MANAGER" or user.is_superuser %}
                <a href="{% url 'leave_app:manager_leave_list' %}"
                    class="text-purple-700 dark:text-purple-300 hover:underline">
                    Manager
                </a>
                {% endif %}

                {% if user|has_group:"HR" or user.is_superuser %}
                <a href="{% url 'leave_app:hr_leave_dashboard' %}"
                    class="text-amber-700 dark:text-amber-300 hover:underline">
                    HR
                </a>
                {% endif %}

                {% if user|has_group:"CEO" or user.is_superuser %}
                <a href="{% url 'leave_app:ceo_dashboard' %}"
                    class="text-indigo-700 dark:text-indigo-300 hover:underline">
                    CEO
                </a>
                {% endif %}

                <span class="hidden sm:inline text-xs text-slate-500 dark:text-slate-400">
                    {{ user.username }}
                </span>
                {% endif %}

                <div class="flex items-center">
                    <div class="scale-75 origin-center">
                        <label class="switch">
                            <input id="theme-toggle-input" type="checkbox" />
                            <div class="slider round">
                                <div class="sun-moon">
                                    <!-- SVG elements unchanged -->
                                </div>

                                <div class="stars">
                                    <!-- SVG elements unchanged -->
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                {% if user.is_authenticated %}
                <a href="{% url 'logout' %}" class="text-red-500 hover:text-red-600">
                    Logout
                </a>
                {% else %}
                <a href="{% url 'login' %}"
                    class="text-blue-600 hover:text-blue-700 dark:text-blue-300 dark:hover:text-blue-200">
                    Login
                </a>
                <a href="{% url 'register' %}"
                    class="text-green-600 hover:text-green-700 dark:text-green-300 dark:hover:text-green-200">
                    Register
                </a>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 py-6">
        {% if messages %}
        <div class="mb-4 space-y-2">
            {% for message in messages %}
            <div class="p-3 rounded text-sm border
                {% if message.tags == 'success' %}
                    bg-emerald-50 text-emerald-800 border-emerald-100
                    dark:bg-emerald-900/40 dark:text-emerald-200 dark:border-emerald-800
                {% elif message.tags == 'error' %}
                    bg-rose-50 text-rose-800 border-rose-100
                    dark:bg-rose-900/40 dark:text-rose-200 dark:border-rose-800
                {% else %}
                    bg-sky-50 text-sky-800 border-sky-100
                    dark:bg-sky-900/40 dark:text-sky-200 dark:border-sky-800
                {% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% block content %}{% endblock %}
    </main>

    <div id="page-loader"
        class="fixed inset-0 z-50 flex items-center justify-center bg-white/60 backdrop-blur-sm dark:bg-slate-900/60">
        <div class="loader">
            <div class="bar1"></div>
            <div class="bar2"></div>
            <div class="bar3"></div>
            <div class="bar4"></div>
            <div class="bar5"></div>
            <div class="bar6"></div>
            <div class="bar7"></div>
            <div class="bar8"></div>
            <div class="bar9"></div>
            <div class="bar10"></div>
            <div class="bar11"></div>
            <div class="bar12"></div>
        </div>
    </div>

    <script>
        (function () {
            const root = document.documentElement;
            const stored = localStorage.getItem("theme");
            const prefersDark = window.matchMedia &&
                window.matchMedia("(prefers-color-scheme: dark)").matches;

            // Set theme when script loads
            if (stored === "dark" || (!stored && prefersDark)) {
                root.classList.add("dark");
            } else {
                root.classList.remove("dark");
            }

            document.addEventListener("DOMContentLoaded", () => {
                const input = document.getElementById("theme-toggle-input");
                if (!input) return;

                // Sync checkbox with current theme
                input.checked = root.classList.contains("dark");

                input.addEventListener("change", () => {
                    const isDark = input.checked;
                    if (isDark) {
                        root.classList.add("dark");
                    } else {
                        root.classList.remove("dark");
                    }
                    localStorage.setItem("theme", isDark ? "dark" : "light");
                });
            });
        })();

        const pageLoader = document.getElementById("page-loader");

        function showLoader() {
            pageLoader.classList.remove("hidden");
        }

        function hideLoader() {
            pageLoader.classList.add("hidden");
        }

        window.addEventListener("load", () => {
            hideLoader();
        });

        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll("form").forEach(form => {
                form.addEventListener("submit", () => {
                    showLoader();
                });
            });
        });
    </script>

</body>
</html>

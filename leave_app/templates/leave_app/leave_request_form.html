{% extends "leave_app/base.html" %}
{% load nav_extras %}
{% block title %}New Leave Request{% endblock %}

{% block content %}
<div class="mx-auto">

    <!-- header + back -->
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-2xl font-semibold tracking-tight">Request Leave Approval</h1>
            <p class="text-sm text-slate-500 dark:text-slate-400">
                Please complete all leave request details before submitting
            </p>
        </div>

        <!-- back button -->
        <a href="{% url 'leave_app:leave_request_list' %}"
           class="text-xs text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200">
            ‚Üê Back
        </a>
    </div>

    <!-- form -->
    <div class="flex justify-center">
        <form method="post" enctype="multipart/form-data"
              class="w-full max-w-lg rounded-2xl border border-slate-100 bg-white/80 p-6 shadow-sm
                     dark:border-slate-800 dark:bg-slate-900/70">
            {% csrf_token %}

            <!-- Leave Type -->
            <div class="mb-4">
                <label class="block mb-1 text-sm font-medium text-slate-700 dark:text-slate-200">
                    Leave Type
                </label>
                {{ form.leave_type|add_class:"w-full rounded-lg border border-slate-200 bg-white/90 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-50" }}

                {% if form.leave_type.errors %}
                <p class="mt-1 text-xs text-rose-500">{{ form.leave_type.errors.0 }}</p>
                {% endif %}

                <div class="mt-2 space-y-1 text-xs text-slate-500">
                {% for b in balances %}
                    <div data-leave-type="{{ b.leave_type.id }}" class="hidden leave-hint">
                        Remaining {{ b.remaining }} days
                        {% if not b.leave_type.is_paid %}
                        (Unlimited)
                        {% endif %}
                    </div>
                {% endfor %}
                </div>
            </div>

            <!-- Dates -->
            <div class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block mb-1 text-sm font-medium text-slate-700 dark:text-slate-200">
                        Start Date
                    </label>
                    {{ form.start_date|add_class:"w-full rounded-lg border border-slate-200 bg-white/90 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-50" }}
                </div>
                <div>
                    <label class="block mb-1 text-sm font-medium text-slate-700 dark:text-slate-200">
                        End Date
                    </label>
                    {{ form.end_date|add_class:"w-full rounded-lg border border-slate-200 bg-white/90 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-50" }}
                </div>
            </div>

            <!-- Attachment -->
            <div class="mb-4">
                <label class="block mb-1 text-sm font-medium text-slate-700 dark:text-slate-200">
                    Attach Supporting Document (if any)
                </label>
                {{ form.attachment|add_class:"w-full rounded-lg border border-slate-200 bg-white/90 px-3 py-2 text-sm file:mr-3 file:rounded-md file:border-0 file:bg-slate-100 file:px-3 file:py-1.5 file:text-xs file:font-medium dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-50 dark:file:bg-slate-800 dark:file:text-slate-100"}}
            </div>

            <!-- Half Day -->
            <div class="mb-4 flex items-center gap-2">
                {{ form.half_day|add_class:"h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 dark:border-slate-600 dark:bg-slate-900/70" }}
                <span class="text-sm text-slate-700 dark:text-slate-200">Half Day Leave</span>
            </div>

            <!-- Reason -->
            <div class="mb-4">
                <label class="block mb-1 text-sm font-medium text-slate-700 dark:text-slate-200">
                    Reason
                </label>
                {{ form.reason|add_class:"w-full rounded-lg border border-slate-200 bg-white/90 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-50" }}
            </div>

            {% if form.non_field_errors %}
            <div class="mb-4 text-sm text-rose-500">
                {{ form.non_field_errors }}
            </div>
            {% endif %}

            <!-- actions -->
            <div class="flex justify-end gap-2">
                <a href="{% url 'leave_app:leave_request_list' %}"
                   class="rounded-lg bg-slate-100 px-4 py-2 text-sm font-medium text-slate-800
                          hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700">
                    Cancel
                </a>
                <button type="submit"
                        class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white
                               shadow-sm hover:bg-indigo-500 dark:bg-indigo-500 dark:hover:bg-indigo-400">
                    Submit Request
                </button>
            </div>
        </form>
    </div>
</div>

<!-- hint script -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const select = document.querySelector("select[name='leave_type']");
    const hints = document.querySelectorAll(".leave-hint");

    function updateHint() {
        hints.forEach(h => h.classList.add("hidden"));
        const active = document.querySelector(
            `.leave-hint[data-leave-type="${select.value}"]`
        );
        if (active) active.classList.remove("hidden");
    }

    if (select) {
        updateHint();
        select.addEventListener("change", updateHint);
    }
});
</script>
{% endblock %}
